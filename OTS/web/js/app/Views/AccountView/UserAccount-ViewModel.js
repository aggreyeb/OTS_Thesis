var OTS=OTS||{};
 OTS.ViewModels=OTS.ViewModels||{};
OTS.ViewModels.UserAccountViewModel=function(){
  
    var me=this;
   //Callbacks
   var forgetPasswordCallback=null;
   var retreivePasswordCallback=null;
   var createAccountCallback=null;
   var validationCallback=null;
   
   me.FirstName=ko.observable("");
   me.LastName=ko.observable("");
   me.LoginEmail=ko.observable("");
   me.Password=ko.observable("");
   me.RepeatPassword=ko.observable("");
   me.ForgetPasswordEmail=ko.observable("");
   me.ForgetPasswordPanelVisible=ko.observable(false);
   me.AccountFormVisible=ko.observable(true);
   
   me.onValidationConpleted=function($validationCallback){
        if($validationCallback===undefined ||$validationCallback===null ){
            throw new Error("$validationCallback is not a function");
        }
        validationCallback=$validationCallback;
   };
   
   me.onForgetPassword=function($forgetPasswordCallback){
        if($forgetPasswordCallback===undefined ||$forgetPasswordCallback===null ){
            throw new Error("$forgetPasswordCallback is not a function");
        }
        forgetPasswordCallback=$forgetPasswordCallback;
   };
   
   me.onRetreivePassword=function($retreivePasswordCallback){
        if($retreivePasswordCallback===undefined ||$retreivePasswordCallback===null ){
            throw new Error("$retreivePasswordCallback is not a function");
        }
        retreivePasswordCallback=$retreivePasswordCallback;
   };
   
   me.onCreateAccount=function($createAccountCallback){
        if($createAccountCallback===undefined ||$createAccountCallback===null ){
            throw new Error("$createAccountCallback is not a function");
        }
        createAccountCallback=$createAccountCallback;
   };
   
   me.CreateAccount=function(){
      
     
       if(createAccountCallback!==null){
          
          var accountItem={
              FirstName:me.FirstName(),
              LastName: me.LastName(),
              Phone:"",
              UserTypeId:3,
              Email:me.LoginEmail(),
              Password:me.Password(),
              IsAutogeneratedPassword:false
          };
           createAccountCallback(accountItem);
      }
   };
   
   me.ForgetPassword=function(){
       if(me.ForgetPasswordPanelVisible()===true){
           me.ForgetPasswordPanelVisible(false);
       }
       else{
            me.ForgetPasswordPanelVisible(true);
       }
   };
   
   me.IsValidEmail=  function (email) {
       var re = /^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
        return re.test(email);
    };
   
   me.RetreivePassword=function(){
       if(retreivePasswordCallback!==null){
           retreivePasswordCallback({Email: me.ForgetPasswordEmail()});
       }
   };
   
 
   me.Validate=function(){
       var valid=true;
       var errors=[];
     
       if(me.FirstName()===""){
           valid=false;
           errors.push("Firstname required");
       }
       
      if(me.LastName()===""){
           valid=false;
          
             errors.push("Lastname required");
       } 
       
       if(me.LoginEmail()===""){
           valid=false;
           
            errors.push("Email required");
       }
       
       if(!me.IsValidEmail(me.LoginEmail())){
           valid=false;
           errors.push("Invalid Email Address");
       }
       
        if(me.Password()===""){
           valid=false;
           
            errors.push("Password required");
       }
       if(me.RepeatPassword()===""){
           valid=false;
           
            errors.push("Repeat password required");
       }
       
       if(me.Password() !==me.RepeatPassword()){
            valid=false;
             errors.push("Password and  Repeat password are not the same");
       }
     
      return {
          IsValid:valid,
          Errors:errors
         }
      
   };
   
   
     me.CanSubmit=ko.computed(function(){
       
       var result= me.Validate();
       if(validationCallback!==null){
           validationCallback({IsValid:result.IsValid,Errors:result.Errors})
       }
       return result.IsValid;
   });
};

